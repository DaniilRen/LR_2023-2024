# Репозиторий команды Algorithm
Репозиторий команды "Algorithm" на НТО 2024 по профилю "Летающая робототехника"

## Состав команды:
#### Бых Даниил - программист
#### Юдов Антон - программист
#### Панкратов Дмитрий - капитан команды
#### Кошкин Максим - инженер-техник


### Запуск программы:
```bash
python3 fligth.py
```


### Файлы программы полета:
    * flight.py (основной файл полета)
    * server_utils.py (файл с реализацией общения с сервером)
### Вспомогательные файлы для отладки из папки [tools](https://github.com/nto2024-lr/algorithm/tree/main/tools):
    * record.py (фотографирование и запись видеопотока)
    * rviz_test.py (тестирование визуализации через rviz) 
    * telem_test.py (тестирование телеметрии коптера)
    * world_gen.py (генерация мира для симуляции) 
### Отладка кода производились при помощи симуляции в Gazebo.  
#### Список исходных файлов для симуляции из папки [simulation](https://github.com/nto2024-lr/algorithm/tree/main/simulation): 
    * target_map.txt (aruco карта)
    * test_world.world (мир для симуляции)
    * map_table.xlsx (таблица для заполнения карты)
    * models (папка с моделями зданий)


## Методы решения задачи:
### Составление aruco карты для симулятора:
#### Для составления карты меток была создана [электронная таблица с номерами маркеров](https://github.com/nto2024-lr/algorithm/blob/main/simulation/map_table.xlsx)
### Создание мира для симуляции:
#### Для создания моделей зданий использовались встроенные инструменты Gazebo
### Взлет и посадка на платформу:
#### Для корректного взлета и посадки координаты платформы с системе aruco_map были записаны заранее в качестве константы
### Обход строительной прощадки:
#### Для обхода всей строительной площадки дрон проходил по всей территории зигзагообразными движениями по сгенерированному в начале скрипта маршруту
### Общее фото зоны строительства:
#### Для общего фото в качестве константы использовалась координаты точки центра в системе aruco_map, заранее высчитанные геометричсеки, зная длину и ширину зоны
### Запрос на сервер:
#### Запрос посылается после облета всей зоны и обрабатывается при помощи библиотеки requests, при подлете к полученным координатам делается фотография
### Распознавание цветов зданий:
#### Цвета зданий распознаются при помощи библиотеки компьютерного зрения OpenCV
### Распознавание этажности зданий:
#### Реальная этажность зданий распознается при помощи лазерного дальномера, затем происходит сравнение с заранее известными значениями для соотвествующих зданий

# Ход работы
Для каждого соревновательного дня выделена отдельная папка (day1-2, day3, day4)  
## Программная часть
#### День 1:
https://github.com/nto2024-lr/algorithm/tree/main/day1-2
1.	Знакомство с оборудованием
2.	Запись карты aruco меток
3.	Создание мира для симуляции
4.	Настройка симуляции
#### День 2:
https://github.com/nto2024-lr/algorithm/tree/main/day1-2
1.	Взлет со стартовой платформы
2.	Прилет в строительную зону
3.	Полет по заданным точкам
4. Полет в центр зоны и фотографирование
5.	Посадка на стратовой платформе
6.	Зачетная попытка, сдача результатов
### День 3:
https://github.com/nto2024-lr/algorithm/tree/main/day3
1. Пролет по всей строительной зоне 
2.	Детектирование зданий, их цветов и координат центров
3.	Отправка данных на сервер
4.	Полет по полученным с сервера координатам, фотографирование с нужной высоты
5.	Зачетная попытка, сдача результатов
### День 4:
https://github.com/nto2024-lr/algorithm/tree/main/day4
1. Оптимизация имеющегося кода
2.	Тренировка полетов
3.	Финальная попытка, сдача задания

## Инженерная часть
#### День 1:
1.	Знакомство с оборудованием
2.	Планирование, разработка идеи
#### День 2:
1.	Создание 3D модели
2.	Создание сборочного чертежа
3.	Печать деталей на 3D принтере
### День 3:
1. Печать оставшихся деталей на 3D принтере
2.	Начало сборки модели
3.	Разработка кода для ардуино
### День 4:
1. Доработка кода для ардуино
2.	Сборка модели
3.	Сдача результата

# Алгоритмы, использованные в решении
Алгоритм распознавания цветов зданий, этажности и координат центров:
1.	Поиск цветных контуров
2.	Проверка на то, был ли детектирован данный цвет ранее
3.	Отсеиваниие лишних контуров по площади
4.	Проверка на положение объекта в середине камеры
5.	Поиск центра контура
6.	Расчет и проверка этажности при помощи лазерного дальномера
7.	Запись результата распознавания в глобальный массив с данными

Алгоритм полета по точкам:
1.	Взлет со стартовой платформы
2.	Автоматическая генерация маршрута пролета по строительной зоне с шагом по x и y в 0.5
3.	Проверка на совпадение текущей точки с центром зоны (в такос случае делается фотография)
4.	Отправка данных на сервер и полет по полученным координатам
5.	Расчет высоты здания при помощи лазерного дальномера, взлет на нужную высоту
6.	Фотографирование здания
7.	Полет в стартовую позицию и посадка

## [Сборочный чертеж устройства](https://github.com/nto2024-lr/algorithm/blob/main/drawing.pdf)

## [Скриншоты модели](https://github.com/nto2024-lr/algorithm/tree/main/charger_box)

## Код для ардуино - `sketch_box.ino`

## Фотография участников команды:
![image](https://github.com/nto2024-lr/algorithm/blob/main/photo_5469817868989354645_y.jpg)
